--[[

        Capy Executor
        By ChatGPT
        Version 4.0.0

]]--

-- Instances

local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Upper = Instance.new("Frame")
local TitleLabel = Instance.new("TextLabel")
local ScrollingFrame = Instance.new("ScrollingFrame")
local LineNumbers = Instance.new("TextLabel")
local TextBox = Instance.new("TextBox")
local Down = Instance.new("Frame")
local ExecuteButton = Instance.new("TextButton")
local ClearButton = Instance.new("TextButton")
local CopyButton = Instance.new("TextButton")
local FloatingButton = Instance.new("TextButton") -- Nút mới

-- Properties

ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Frame
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.3, 0, 0.2, 0)
MainFrame.Size = UDim2.new(0, 600, 0, 350)
MainFrame.Active = true
MainFrame.Visible = false -- Mặc định ẩn
MainFrame.ClipsDescendants = true

-- Upper Bar
Upper.Name = "Upper"
Upper.Parent = MainFrame
Upper.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
Upper.BorderSizePixel = 0
Upper.Size = UDim2.new(1, 0, 0, 25)

TitleLabel.Parent = Upper
TitleLabel.BackgroundColor3 = Color3.new(1, 1, 1)
TitleLabel.BorderSizePixel = 0
TitleLabel.Size = UDim2.new(0, 100, 0, 25)
TitleLabel.Font = Enum.Font.SourceSans
TitleLabel.Text = "Capy Executor"
TitleLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
TitleLabel.TextSize = 18
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Scrolling Frame
ScrollingFrame.Parent = MainFrame
ScrollingFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
ScrollingFrame.BorderSizePixel = 0
ScrollingFrame.Position = UDim2.new(0, 0, 0.083, 0)
ScrollingFrame.Size = UDim2.new(1, 0, 0.7, 0)
ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
ScrollingFrame.ScrollBarThickness = 8
ScrollingFrame.ScrollingEnabled = true

LineNumbers.Name = "LineNumbers"
LineNumbers.Parent = ScrollingFrame
LineNumbers.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
LineNumbers.BorderSizePixel = 0
LineNumbers.Size = UDim2.new(0, 30, 1, 0)
LineNumbers.Font = Enum.Font.SourceSans
LineNumbers.Text = "1"
LineNumbers.TextColor3 = Color3.fromRGB(200, 200, 200)
LineNumbers.TextSize = 14
LineNumbers.TextXAlignment = Enum.TextXAlignment.Right

TextBox.Parent = ScrollingFrame
TextBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
TextBox.BorderSizePixel = 0
TextBox.Position = UDim2.new(0, 35, 0, 0)
TextBox.Size = UDim2.new(1, -35, 1, 0)
TextBox.Font = Enum.Font.Code
TextBox.Text = "-- print(\"hello world\")"
TextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
TextBox.TextSize = 14
TextBox.ClearTextOnFocus = false
TextBox.MultiLine = true

-- Down Bar
Down.Name = "Down"
Down.Parent = MainFrame
Down.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
Down.Position = UDim2.new(0, 0, 0.8, 0)
Down.Size = UDim2.new(1, 0, 0.2, 0)

ExecuteButton.Parent = Down
ExecuteButton.BackgroundColor3 = Color3.fromRGB(75, 75, 75)
ExecuteButton.Size = UDim2.new(0, 85, 0, 30)
ExecuteButton.Position = UDim2.new(0.05, 0, 0.5, -15)
ExecuteButton.Font = Enum.Font.SourceSans
ExecuteButton.Text = "Execute"
ExecuteButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ExecuteButton.TextSize = 14

ClearButton.Parent = Down
ClearButton.BackgroundColor3 = Color3.fromRGB(75, 75, 75)
ClearButton.Size = UDim2.new(0, 85, 0, 30)
ClearButton.Position = UDim2.new(0.20, 0, 0.5, -15)
ClearButton.Font = Enum.Font.SourceSans
ClearButton.Text = "Clear"
ClearButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ClearButton.TextSize = 14

CopyButton.Parent = Down
CopyButton.BackgroundColor3 = Color3.fromRGB(75, 75, 75)
CopyButton.Size = UDim2.new(0, 85, 0, 30)
CopyButton.Position = UDim2.new(0.35, 0, 0.5, -15)
CopyButton.Font = Enum.Font.SourceSans
CopyButton.Text = "Copy"
CopyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CopyButton.TextSize = 14

-- Floating Button
FloatingButton.Parent = ScreenGui
FloatingButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
FloatingButton.BorderSizePixel = 0
FloatingButton.Position = UDim2.new(0.05, 0, 0.1, 0)
FloatingButton.Size = UDim2.new(0, 100, 0, 40)
FloatingButton.Font = Enum.Font.SourceSans
FloatingButton.Text = "Toggle Capy"
FloatingButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FloatingButton.TextSize = 14
FloatingButton.Active = true

-- Drag Functions
local function enableDrag(frame)
    local dragToggle, dragStart, startPos
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragToggle = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragToggle = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if dragToggle and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- Enable dragging for MainFrame and FloatingButton
enableDrag(MainFrame)
enableDrag(FloatingButton)

-- Toggle visibility of MainFrame
FloatingButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- Other button functions
ExecuteButton.MouseButton1Click:Connect(function()
    local success, err = pcall(function()
        loadstring(TextBox.Text)()
    end)
    if not success then
        print("Error executing script: " .. err)
    end
end)

ClearButton.MouseButton1Click:Connect(function()
    TextBox.Text = ""
end)

CopyButton.MouseButton1Click:Connect(function()
    if setclipboard then
        setclipboard(TextBox.Text)
    else
        print("Clipboard not supported.")
    end
end)

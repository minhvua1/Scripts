local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Upper = Instance.new("Frame")
local TextLabel = Instance.new("TextLabel")
local Down = Instance.new("Frame")
local TextBox = Instance.new("TextBox")
local LineNumbers = Instance.new("Frame")
local ExecuteButton = Instance.new("TextButton")
local ClearButton = Instance.new("TextButton")
local CopyButton = Instance.new("TextButton")
local MinimizedFrame = Instance.new("Frame")
local MinimizedButton = Instance.new("TextButton")
local Logo = Instance.new("ImageLabel")

-- Parent to PlayerGui
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- MainFrame Properties
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50) -- Dark gray
MainFrame.BorderColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.Position = UDim2.new(0.05, 0, 0.15, 0)
MainFrame.Size = UDim2.new(0, 600, 0, 400)

-- Upper (Title bar) Properties
Upper.Name = "Upper"
Upper.Parent = MainFrame
Upper.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Upper.Size = UDim2.new(1, 0, 0, 30)

TextLabel.Parent = Upper
TextLabel.BackgroundTransparency = 1
TextLabel.Text = "Capy Executor"
TextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TextLabel.TextSize = 20
TextLabel.Position = UDim2.new(0, 10, 0, 5)

-- Down (Button container) Properties
Down.Name = "Down"
Down.Parent = MainFrame
Down.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Down.Position = UDim2.new(0, 0, 0.85, 0)
Down.Size = UDim2.new(1, 0, 0, 40)

-- TextBox Properties (TextBox will allow scrolling horizontally)
TextBox.Parent = MainFrame
TextBox.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
TextBox.Position = UDim2.new(0.05, 0, 0.1, 0)
TextBox.Size = UDim2.new(0.9, 0, 0.75, 0)
TextBox.Font = Enum.Font.SourceSans
TextBox.Text = "-- print('Hello World!')"
TextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
TextBox.TextSize = 14
TextBox.TextWrapped = true
TextBox.ClearTextOnFocus = false
TextBox.TextXAlignment = Enum.TextXAlignment.Left -- Align text to left
TextBox.TextYAlignment = Enum.TextYAlignment.Top -- Align text to top

-- LineNumbers (Left of TextBox)
LineNumbers.Name = "LineNumbers"
LineNumbers.Parent = MainFrame
LineNumbers.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
LineNumbers.Position = UDim2.new(0, 0, 0.1, 0)
LineNumbers.Size = UDim2.new(0, 30, 0.75, 0)

-- Buttons (Execute, Clear, Copy)
ExecuteButton.Name = "ExecuteButton"
ExecuteButton.Parent = Down
ExecuteButton.BackgroundColor3 = Color3.fromRGB(0, 122, 255)
ExecuteButton.Size = UDim2.new(0.3, -5, 1, 0)
ExecuteButton.Text = "Execute"
ExecuteButton.TextColor3 = Color3.fromRGB(255, 255, 255)

ClearButton.Name = "ClearButton"
ClearButton.Parent = Down
ClearButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ClearButton.Position = UDim2.new(0.35, 0, 0, 0)
ClearButton.Size = UDim2.new(0.3, -5, 1, 0)
ClearButton.Text = "Clear"
ClearButton.TextColor3 = Color3.fromRGB(255, 255, 255)

CopyButton.Name = "CopyButton"
CopyButton.Parent = Down
CopyButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
CopyButton.Position = UDim2.new(0.7, 0, 0, 0)
CopyButton.Size = UDim2.new(0.3, -5, 1, 0)
CopyButton.Text = "Copy"
CopyButton.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Minimized Frame (Small draggable version)
MinimizedFrame.Name = "MinimizedFrame"
MinimizedFrame.Parent = ScreenGui
MinimizedFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MinimizedFrame.Position = UDim2.new(0.05, 0, 0.05, 0)
MinimizedFrame.Size = UDim2.new(0, 50, 0, 50)
MinimizedFrame.Visible = false -- Initially hidden

MinimizedButton.Name = "MinimizedButton"
MinimizedButton.Parent = MinimizedFrame
MinimizedButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
MinimizedButton.Size = UDim2.new(1, 0, 1, 0)
MinimizedButton.Text = "-"
MinimizedButton.TextColor3 = Color3.fromRGB(255, 255, 255)

Logo.Parent = MinimizedFrame
Logo.Size = UDim2.new(1, 0, 1, 0)
Logo.Image = "rbxassetid://yourImageID"  -- Replace with the ID of your image

-- Button Functions
ExecuteButton.MouseButton1Click:Connect(function()
    local success, err = pcall(function()
        loadstring(TextBox.Text)()
    end)
    if not success then
        print("Error executing script: " .. err)
    end
end)

ClearButton.MouseButton1Click:Connect(function()
    TextBox.Text = ""
end)

CopyButton.MouseButton1Click:Connect(function()
    if setclipboard then
        setclipboard(TextBox.Text)
    else
        print("Clipboard not supported.")
    end
end)

-- Minimize Button Logic
MinimizedButton.MouseButton1Click:Connect(function()
    MinimizedFrame.Visible = not MinimizedFrame.Visible
    MainFrame.Visible = not MainFrame.Visible
end)

-- Function to make a GUI draggable
local function enableDrag(frame)
    local dragToggle = nil
    local dragPos = nil
    local dragInput = nil

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = true
            dragPos = UDim2.new(0, input.Position.X, 0, input.Position.Y)
            input.Consumed = true
        end
    end)

    frame.InputChanged:Connect(function(input)
        if dragToggle and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragPos
            frame.Position = UDim2.new(frame.Position.X.Scale, frame.Position.X.Offset + delta.X, frame.Position.Y.Scale, frame.Position.Y.Offset + delta.Y)
        end
    end)

    frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragToggle = false
        end
    end)
end

-- Make both MainFrame and MinimizedFrame draggable
enableDrag(MainFrame)
enableDrag(MinimizedFrame)

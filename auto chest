local MaxSpeed = 275 -- Tốc độ di chuyển
local WaitBetweenChests = 0.5 -- Thời gian chờ giữa các rương (giây)
local LocalPlayer = game:GetService("Players").LocalPlayer
local UncheckedChests = {}
local FirstRun = true
local TweenService = game:GetService("TweenService")
local tweening = false
local wait = task.wait
local httpService = game:GetService("HttpService")
local teleportService = game:GetService("TeleportService")
local currentGame = game.PlaceId

-- Tạo ScreenGui
local gui = Instance.new("ScreenGui")
gui.Parent = game:GetService("CoreGui")

local uiVisible = true -- Biến kiểm soát hiển thị UI
local collectChests = true -- Biến kiểm soát việc lượm rương

-- Giao diện chính
local uiContainer = Instance.new("Frame")
uiContainer.Size = UDim2.new(1, 0, 0, 60) -- Chiều cao tối đa 60
uiContainer.Position = UDim2.new(0, 0, 0, 10) -- Gần trên cùng
uiContainer.BackgroundTransparency = 1
uiContainer.Active = true
uiContainer.Draggable = true
uiContainer.Parent = gui

-- Nút bật/tắt UI
local toggleUIButton = Instance.new("TextButton")
toggleUIButton.Size = UDim2.new(0, 40, 0, 40)
toggleUIButton.Position = UDim2.new(0, 10, 0, 10)
toggleUIButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
toggleUIButton.TextColor3 = Color3.new(1, 1, 1)
toggleUIButton.TextScaled = true
toggleUIButton.Text = "-"
toggleUIButton.Parent = gui

toggleUIButton.MouseButton1Click:Connect(function()
    uiVisible = not uiVisible
    uiContainer.Visible = uiVisible
    if uiVisible then
        toggleUIButton.Text = "-"
    else
        toggleUIButton.Text = "+"
    end
end)

-- Kích thước và khoảng cách giữa các nút
local buttonSize = UDim2.new(0, 150, 0, 40)
local buttonSpacing = 10 -- Khoảng cách giữa các nút
local buttonStartX = 0.5 -- Bắt đầu từ giữa màn hình

-- TextLabel để hiển thị số rương còn lại
local chestsLabel = Instance.new("TextLabel")
chestsLabel.Size = buttonSize
chestsLabel.Position = UDim2.new(buttonStartX, -250, 0, 10)
chestsLabel.BackgroundColor3 = Color3.new(0, 0, 0)
chestsLabel.TextColor3 = Color3.new(1, 1, 1)
chestsLabel.TextScaled = true
chestsLabel.Text = "Số rương còn lại: Đang tải..."
chestsLabel.Parent = uiContainer

-- TextLabel để ghi credit
local creditLabel = Instance.new("TextLabel")
creditLabel.Size = buttonSize
creditLabel.Position = UDim2.new(buttonStartX, -75, 0, 10)
creditLabel.BackgroundColor3 = Color3.new(0, 0, 0)
creditLabel.TextColor3 = Color3.new(1, 1, 1)
creditLabel.TextScaled = true
creditLabel.Text = "Làm bởi Capy"
creditLabel.Parent = uiContainer

-- Nút để bật/tắt lượm rương
local toggleButton = Instance.new("TextButton")
toggleButton.Size = buttonSize
toggleButton.Position = UDim2.new(buttonStartX, 100, 0, 10)
toggleButton.BackgroundColor3 = Color3.new(0, 1, 0)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.TextScaled = true
toggleButton.Text = "-"
toggleButton.Parent = uiContainer

toggleButton.MouseButton1Click:Connect(function()
    collectChests = not collectChests -- Đảo trạng thái
    if collectChests then
        toggleButton.Text = "-"
        toggleButton.BackgroundColor3 = Color3.new(0, 1, 0) -- Chuyển thành màu xanh
    else
        toggleButton.Text = "+"
        toggleButton.BackgroundColor3 = Color3.new(1, 0, 0) -- Chuyển thành màu đỏ
    end
end)

-- Hàm lấy thông tin nhân vật
local function getCharacter()
    if not LocalPlayer.Character then
        LocalPlayer.CharacterAdded:Wait()
    end
    LocalPlayer.Character:WaitForChild("HumanoidRootPart")
    return LocalPlayer.Character
end

-- Hàm lấy danh sách rương, sắp xếp theo khoảng cách
local function getChestsSorted()
    if FirstRun then
        FirstRun = false
        for _, Object in pairs(workspace:GetDescendants()) do
            if Object.Name:find("Chest") and Object:IsA("Part") then
                table.insert(UncheckedChests, Object)
            end
        end
    end
    local Chests = {}
    for _, Chest in pairs(UncheckedChests) do
        if Chest:FindFirstChild("TouchInterest") then
            table.insert(Chests, Chest)
        end
    end
    table.sort(Chests, function(ChestA, ChestB)
        local RootPos = getCharacter().HumanoidRootPart.Position
        return (RootPos - ChestA.Position).Magnitude < (RootPos - ChestB.Position).Magnitude
    end)
    return Chests
end

-- Hàm di chuyển đến rương
local function TeleportToChest(Chest)
    tweening = true
    local RootPart = getCharacter().HumanoidRootPart
    local tweenInfo = TweenInfo.new((RootPart.Position - Chest.Position).Magnitude / MaxSpeed, Enum.EasingStyle.Linear)
    local tween = TweenService:Create(RootPart, tweenInfo, {CFrame = Chest.CFrame})
    tween:Play()
    tween.Completed:Wait(4)
    tweening = false
end

-- Logic lượm rương
task.spawn(function()
    while true do
        wait()
        if collectChests and not tweening then
            local Chests = getChestsSorted()
            if #Chests > 0 then
                chestsLabel.Text = "Số rương còn lại: " .. tostring(#Chests)
                TeleportToChest(Chests[1])
                wait(WaitBetweenChests)
            else
                chestsLabel.Text = "Không còn rương nào!"
                collectChests = false -- Tạm ngưng nếu không còn rương
            end
        end
    end
end)
